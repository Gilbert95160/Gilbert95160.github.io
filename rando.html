<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Randonn√©es programm√©es</title>
  <meta name="theme-color" content="#1f5132" />
  <style>
    :root{
      --bg:#f7f7f6; --card:#ffffff; --ink:#203020; --muted:#5c6b5c; --brand:#2a6f3b; --brand-2:#1f5132; --accent:#e7f4ea;
      --danger:#c52b31; --ring: 0 0 0 3px rgba(42,111,59,.2);
      --radius:18px; --shadow:0 10px 25px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:980px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:clamp(22px,3.6vw,34px);margin:0;font-weight:800;letter-spacing:.2px}
    .bar{height:4px;background:linear-gradient(90deg,var(--brand),var(--brand-2));border-radius:999px;margin:14px 0 18px}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.65rem .9rem;border-radius:12px;border:1px solid #dfe4df;background:#fff;cursor:pointer;box-shadow:0 1px 0 rgba(0,0,0,.03)}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.ghost{background:transparent}
    .btn:focus{outline:none;box-shadow:var(--ring)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px 18px 14px;position:relative;border:1px solid #e7ece7}
    .title{font-size:20px;font-weight:800;margin:0 0 6px}
    .desc{color:var(--muted);margin:0 0 12px}
    .row{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;background:#f3f6f3;border:1px solid #e2e8e2;font-weight:600}
    .meta{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
    .meta .chip{justify-content:center}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .actions .btn.danger{background:#fff;border-color:#f3c0c0;color:#a0181c}
    .actions .btn.map{background:var(--accent);border-color:#cfe9d6;color:#135a2b}
    .date-badge{position:absolute;right:14px;top:14px;background:var(--brand-2);color:#fff;border-radius:14px;padding:8px 10px;line-height:1;text-align:center;min-width:78px}
    .date-badge small{display:block;opacity:.9;font-weight:600}
    .date-badge strong{display:block;font-size:18px;margin-top:4px}
    .remarques{margin-top:14px;padding:12px 14px;border-left:5px solid var(--danger);background:#fff1f1;border-radius:12px;color:#7a1518;font-weight:600;white-space:pre-line}
    .drawer{position:fixed;inset:auto 0 0 0;background:#fff;border-radius:18px 18px 0 0;box-shadow:0 -10px 30px rgba(0,0,0,.14);transform:translateY(100%);transition:transform .28s ease;z-index:30}
    .drawer.open{transform:translateY(0)}
    .drawer header{padding:14px 16px;border-bottom:1px solid #ecf1ec}
    form{padding:14px 16px;display:grid;gap:10px}
    label{font-weight:700;font-size:.95rem}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #dfe4df;background:#f9fbf9}
    textarea{min-height:80px}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .row-end{display:flex;gap:10px;justify-content:flex-end;padding:0 16px 16px}
    .empty{padding:24px;border:2px dashed #d9e1d9;border-radius:16px;color:#5a6a5a;text-align:center}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    a.btn{ text-decoration:none }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <span aria-hidden="true" style="font-size:22px">üóìÔ∏è</span>
      <h1>Randonn√©es programm√©es</h1>
      <div style="flex:1"></div>
      <button id="addBtn" class="btn primary">Ôºã Ajouter</button>
    </header>
    <div class="bar"></div>

    <section id="cards" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>
      Aucune randonn√©e pour l‚Äôinstant. Cliquez sur <strong>Ajouter</strong> pour cr√©er la premi√®re fiche.
    </div>
  </div>

  <aside id="drawer" class="drawer">
    <header>
      <strong id="drawerTitle">Nouvelle randonn√©e</strong>
      <div style="flex:1"></div>
      <button id="closeDrawer" class="btn ghost">‚úï</button>
    </header>
    <form id="hikeForm">
      <input type="hidden" id="hidIndex" />
      <div class="two">
        <div>
          <label for="date">Date</label>
          <input id="date" type="date" required />
        </div>
        <div>
          <label for="title">Titre</label>
          <input id="title" type="text" required />
        </div>
      </div>
      <div class="two">
        <div>
          <label for="heure">Heure de d√©part</label>
          <input id="heure" type="time" />
        </div>
        <div>
          <label for="lieu">Lieu de RDV</label>
          <input id="lieu" type="text" />
        </div>
      </div>
      <label for="desc">Description</label>
      <textarea id="desc"></textarea>
      <div class="two">
        <div>
          <label for="accomp">Accompagnateur</label>
          <input id="accomp" type="text" />
        </div>
        <div>
          <label for="gpx">Lien GPX (URL)</label>
          <input id="gpx" type="url" />
        </div>
      </div>
      <div class="two">
        <div>
          <label for="distance">Kilom√©trage (km)</label>
          <input id="distance" type="number" step="0.1" />
        </div>
        <div>
          <label for="denivele">D√©nivel√© (m)</label>
          <input id="denivele" type="number" step="1" />
        </div>
      </div>
      <label for="remarques">Remarques importantes</label>
      <textarea id="remarques" placeholder="‚ö†Ô∏è Ne pas oublier son casse-cro√ªte"></textarea>
      <div class="row-end">
        <button type="reset" class="btn">Effacer</button>
        <button class="btn primary">Enregistrer</button>
      </div>
    </form>
  </aside>

  <script>
    const KEY = 'rando-app:v2';
    let hikes = [];
    const $ = s=>document.querySelector(s);
    const $$ = s=>Array.from(document.querySelectorAll(s));
    const fmtDateBadge = iso => {
      if(!iso) return {d:"",m:"",wd:""};
      const d = new Date(iso+'T12:00:00');
      const wd = d.toLocaleDateString('fr-FR',{weekday:'short'});
      return {d:d.getDate().toString().padStart(2,'0'),m:d.toLocaleDateString('fr-FR',{month:'short'}),wd:wd};
    };
    const gmapsUrl = (lat,lng,label='') => (lat && lng) ? `https://maps.google.com/?q=${lat},${lng}${label?` (${encodeURIComponent(label)})`:''}` : null;
    const save = () => localStorage.setItem(KEY,JSON.stringify(hikes));
    const load = () => {try{hikes=JSON.parse(localStorage.getItem(KEY)||'[]')}catch{hikes=[]}};

    function render(){
      const wrap=$('#cards');wrap.innerHTML='';
      if(!hikes.length){$('#empty').hidden=false;return}
      $('#empty').hidden=true;
      hikes.sort((a,b)=>(a.date||'').localeCompare(b.date||''));
      for(const [i,h] of hikes.entries()){
        const {d,m,wd}=fmtDateBadge(h.date);
        const map=gmapsUrl(h.lat,h.lng,h.lieu);
        const card=document.createElement('article');
        card.className='card';
        card.innerHTML=`
          <div class="date-badge"><small>${wd}</small><strong>${d} ${m}</strong></div>
          <h2 class="title">${escapeHtml(h.title||'Sans titre')}</h2>
          ${h.heure?`<p class="desc">üïí D√©part : ${escapeHtml(h.heure)}</p>`:''}
          ${h.desc?`<p class="desc">${escapeHtml(h.desc)}</p>`:''}
          <div class="row">
            ${h.lieu?`<span class="chip">üìç ${escapeHtml(h.lieu)}</span>`:''}
            ${h.distance?`<span class="chip">üö∂ ${h.distance} km</span>`:''}
            ${h.denivele?`<span class="chip">‚õ∞Ô∏è ${h.denivele} m</span>`:''}
          </div>
          <div class="row" style="margin-top:10px">
            ${h.accomp?`<span class="chip">üß≠ ${escapeHtml(h.accomp)}</span>`:''}
          </div>
          ${h.remarques?`<div class="remarques">${h.remarques}</div>`:''}
          <div class="actions">
            ${map?`<a class="btn map" target="_blank" href="${map}">üó∫Ô∏è Itin√©raire</a>`:''}
            ${h.gpx?`<a class="btn" target="_blank" href="${h.gpx}">üìÑ GPX</a>`:''}
            <button class="btn" data-edit="${i}">‚úèÔ∏è Modifier</button>
            <button class="btn danger" data-del="${i}">üóëÔ∏è Supprimer</button>
          </div>`;
        wrap.appendChild(card);
      }
      $$('[data-edit]').forEach(b=>b.onclick=()=>edit(+b.dataset.edit));
      $$('[data-del]').forEach(b=>b.onclick=()=>del(+b.dataset.del));
    }

    function escapeHtml(s){return String(s).replace(/[&<>]/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[ch]));}
    function edit(i){const h=hikes[i];if(!h)return;$('#drawerTitle').textContent='Modifier';$('#hidIndex').value=i;for(const k of ['date','title','heure','desc','lieu','accomp','lat','lng','distance','denivele','gpx','remarques']){const el=document.getElementById(k);if(el)el.value=h[k]??'';}openDrawer();}
    function del(i){if(!confirm('Supprimer ?'))return;hikes.splice(i,1);save();render();}

    const drawer=$('#drawer');
    function openDrawer(){drawer.classList.add('open')}
    function closeDrawer(){drawer.classList.remove('open')}

    $('#hikeForm').addEventListener('submit',e=>{
      e.preventDefault();
      const h=Object.fromEntries(['date','title','heure','desc','lieu','accomp','lat','lng','distance','denivele','gpx','remarques'].map(id=>[id,$('#'+id).value.trim()]));
      if(h.lat)h.lat=parseFloat(h.lat);if(h.lng)h.lng=parseFloat(h.lng);if(h.distance)h.distance=parseFloat(h.distance);if(h.denivele)h.denivele=parseInt(h.denivele);
      const idx=$('#hidIndex').value;if(idx!=='')hikes[+idx]=h;else hikes.push(h);
      save();render();e.target.reset();$('#hidIndex').value='';$('#drawerTitle').textContent='Nouvelle randonn√©e';closeDrawer();
    });

    $('#addBtn').onclick=()=>{$('#hikeForm').reset();$('#hidIndex').value='';$('#drawerTitle').textContent='Nouvelle randonn√©e';openDrawer();};
    $('#closeDrawer').onclick=closeDrawer;

    load();render();
  </script>
</body>
</html>
